%h1
  Plan für Krieg
  = @war.title
  - if @war.started
    (angefangen)

%table.table{id: 'plan', data: {'post-url': update_attack_war_path(@war),
             'get-url': ajax_plan_war_path(@war) }, class: 'table table-bordered table-hover'}
  %thead
    %td Name
    - @war.count.times do |i|
      %td{id: "base_#{i+1}", class: "base_#{i+1}"}= i +1
  %tbody
    - @warriors.each do |w|
      %tr{class: "index_#{w.index}"}
        %td.bg-success{id: "index_#{w.index}", data: { name: w.user_name, wid: w.id }}= "#{w.index}. #{w.user_name}"
        - w.averages.each_with_index do |e,base|
          - marked = 'attack'
          - id = "#{w.index}_#{base+1}"
          %td{class: "attack base_#{base + 1}", id: "T_#{id}", data: { index: w.index, base: base + 1}}
            .avg= e.to_s.gsub('.0','')
          - tt = "<ul class='estimate-list'>"
          - w.each_estimate(base+1) do |b|
            - tt << "<li>#{b.stars} #{User.name_for(b.user_id)}</li>"
          - tt << "</ul>"
          %script
            $("#T_#{id} div.avg").tooltip({'title': "#{tt.html_safe}", html: true });

- unless @war.started
  = javascript_tag "setupPlan();"
  = form_for @war, url: {action: "freeze"} do |f|
    = f.submit "Freeze Plan", data: { confirm: "Sicher? Es gibt kein zurück." }
- else
  = javascript_tag "setupStartedWar();"

%div{class: "modal fade", id: "finishedModal", role: "dialog", 'aria-labelledby': "exampleModalLabel"}
  %div{class: "modal-dialog", role: "document"}
    .modal-content
      .modal-header
        %button{type: "button", class: "close", 'data-dismiss': "modal", 'aria-label': "Close"}
          %span{'aria-hidden': "true"}
            &times;
        %h4{class: "modal-title"}
          Gib das Ergebnis des Angriffs von
          %span{id: 'warrior-name'}
          auf die
          %span{id: 'enemy-name'}
          ein.

      = form_for @war, url: {action: "result"} do |f|
        .modal-body
          %input{type: "hidden", class: "form-control", disabled: 1, id: "warrior-id"}
          %input{type: "hidden", class: "form-control", disabled: 1, id: "enemy-index"}
          .form-group
            <label for="percent" class="control-label">Prozent:</label>
            %input{type: "text", class: "form-control", id: "percent"}

          .form-group
            %div.btn-group{'data-toggle': "buttons"}
              %label{class: "btn btn-success"}
                %input{type: "checkbox", autocomplete: "off", id: 'townhall'} Rathaus erledigt?

        .modal-footer
          <button type="button" class="btn btn-default" data-dismiss="modal">Abbrechen</button>
          = f.submit 'Speichern', type: 'button', class: "btn btn-primary", id: 'submit_result'
